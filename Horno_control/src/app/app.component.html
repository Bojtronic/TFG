<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<div class="dashboard-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <mat-icon class="header-icon">developer_board</mat-icon>
      <h1>Control IoT - Arduino Cloud</h1>
      <span class="subtitle">Monitorización en tiempo real</span>
    </div>
    
    <!-- Status Badge -->
    <div class="status-badge" [class.connected]="isConnected" [class.disconnected]="!isConnected">
      <mat-icon>{{ isConnected ? 'wifi' : 'wifi_off' }}</mat-icon>
      <span>{{ isConnected ? 'Conectado' : 'Desconectado' }}</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- LED Control Card -->
    <mat-card class="control-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="card-icon">lightbulb</mat-icon>
          Control LED
        </mat-card-title>
        <mat-card-subtitle>Gestión remota del LED</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="control-state">
          <div class="state-indicator" [class.active]="ledStatus">
            <div class="led-visual" [class.on]="ledStatus"></div>
            <span class="state-text">{{ ledStatus ? 'ENCENDIDO' : 'APAGADO' }}</span>
          </div>
        </div>

        <button mat-raised-button 
                class="control-button"
                [color]="ledStatus ? 'warn' : 'primary'"
                (click)="toggleLed()"
                [disabled]="!isConnected">
          <mat-icon>{{ ledStatus ? 'toggle_off' : 'toggle_on' }}</mat-icon>
          {{ ledStatus ? 'Apagar LED' : 'Encender LED' }}
        </button>
      </mat-card-content>
    </mat-card>

    <!-- Sensor Data Card -->
    <mat-card class="sensor-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="card-icon">brightness_medium</mat-icon>
          Sensor Fotoresistor
        </mat-card-title>
        <mat-card-subtitle>Lectura en tiempo real</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="sensor-display">
          <div class="value-container">
            <span class="value">{{ fotoresistorValue }}</span>
            <span class="unit">lux</span>
          </div>
          
          <div class="sensor-progress">
            <mat-progress-bar 
              mode="determinate" 
              [value]="getSensorPercentage()"
              [color]="getSensorColor()">
            </mat-progress-bar>
            <div class="progress-labels">
              <span>0</span>
              <span>4095</span>
            </div>
          </div>
        </div>

        <div class="sensor-info">
          <mat-icon>info</mat-icon>
          <span>Valor analógico leído del sensor</span>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Connection Card -->
    <mat-card class="connection-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="card-icon">cloud</mat-icon>
          Conexión IoT
        </mat-card-title>
        <mat-card-subtitle>Estado de la conexión</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="connection-info">
          <div class="info-item">
            <mat-icon>device_hub</mat-icon>
            <span>Dispositivo: {{ config.deviceId.slice(0, 8) }}...</span>
          </div>
          <div class="info-item">
            <mat-icon>storage</mat-icon>
            <span>Thing: {{ config.thingId.slice(0, 8) }}...</span>
          </div>
        </div>

        <div class="connection-actions">
          <button mat-button 
                  (click)="refreshValues()" 
                  [disabled]="!isConnected"
                  class="action-button">
            <mat-icon>refresh</mat-icon>
            Actualizar
          </button>

          <button mat-button 
                  (click)="disconnect()" 
                  *ngIf="isConnected"
                  class="action-button disconnect">
            <mat-icon>power_settings_new</mat-icon>
            Desconectar
          </button>

          <button mat-button 
                  (click)="initializeConnection()" 
                  *ngIf="!isConnected"
                  class="action-button connect">
            <mat-icon>link</mat-icon>
            Conectar
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-overlay" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <span class="loading-text">Conectando con Arduino Cloud...</span>
  </div>

  <!-- Quick Stats Footer -->
  <div class="footer-stats">
    <div class="stat-item">
      <mat-icon>update</mat-icon>
      <span>Última actualización: {{ lastUpdate | date:'HH:mm:ss' }}</span>
    </div>
    <div class="stat-item">
      <mat-icon>data_usage</mat-icon>
      <span>Estado: {{ isLoading ? 'Procesando...' : 'Listo' }}</span>
    </div>
  </div>
</div>
